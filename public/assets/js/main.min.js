var Main = {
    init: function () {

    that = this;
    that.LeadNotification();
    },

    LeadNotification: function(){
          function notification(){
        $.ajax({ 
            type: 'GET', 
            url: '/api/notification', 
            dataType: 'json',
            success: function (data) {
                if (data.status == 'new') {
                    notify({
                        type: "success",
                        title: "Nowy Lead!",
                        message: "Zdobyłeś nowego lead'a o wartości: " + data.amount + " zł",
                        position: {
                            x: "right",
                            y: "top" 
                        },
                        icon: '<i class="fa fa-trophy"></i>',
                        size: "normal",
                        overlay: false,
                        closeBtn: false,
                        overflowHide: false,
                        spacing: 20,
                        theme: "default",
                        autoHide: true,
                        delay: 5000,
                        onShow: function(){
                            if (data.lead_sound != 0) {
                                if ($('#lead_sound_player').length){
                                    $("#lead_sound_player").attr({'src':'/assets/audio/lead/'+ data.lead_sound +'.mp3','autoplay':'autoplay'})
                                }else{
                                    $("body").append('<audio id="lead_sound_player" style="display: none;"></audio>');
                                    $("#lead_sound_player").attr({'src':'/assets/audio/lead/'+ data.lead_sound +'.mp3','autoplay':'autoplay'});
                                }
                            }
                        },
                        template: '<div class="notify"><div class="notify-text"></div></div>'
                    });
                }
            }
        });
    }

setInterval(function(){
   notification();
}, 15000);

    },
}

var Payout = {
    init: function () {

    that = this;
    that.Choices();
    },

    Choices: function(){
      if ($('#form').length){
        var form = new Choices('#form', {
          search: false,
          shouldSort: false,
          itemSelectText: 'Kliknij aby wybrać',
        });
      }

      if ($('#priority').length){
        var priority = new Choices('#priority', {
          search: false,
          shouldSort: false,
          itemSelectText: 'Kliknij aby wybrać',
        });
      }

    },
}

var Setting = {
    init: function () {

    that = this;
    that.Choices();
    that.InputMask();
    that.AccountType();
    that.LeadSound();
    },

    Choices: function(){
      if ($('#account_type').length){
        var account_type = new Choices('#account_type', {
          search: false,
          shouldSort: false,
          itemSelectText: 'Kliknij aby wybrać',
        });
      }

      if ($('#lead_sound').length){
        var lead_sound = new Choices('#lead_sound', {
          search: false,
          shouldSort: false,
          itemSelectText: 'Kliknij aby wybrać',
        });
      }

      if ($('#rank_view').length){
        var rank_view = new Choices('#rank_view', {
          search: false,
          shouldSort: false,
          itemSelectText: 'Kliknij aby wybrać',
        });
      }

      if ($('#chat_view').length){
        var chat_view = new Choices('#chat_view', {
          search: false,
          shouldSort: false,
          itemSelectText: 'Kliknij aby wybrać',
        });
      }

    },

    InputMask: function(){
      if ($('#bank_account').length){
        $("#bank_account").inputmask({"mask": "99 9999 9999 9999 9999 9999 9999"});
      }
      
      if ($('#zip_code').length){
        $("#zip_code").inputmask("99-999");
      }

      if ($('#pesel').length){
        $("#pesel").inputmask("99999999999");
      }
    },

    AccountType: function(){
      var value = $('#account_type :selected').val();
      if (value == 'private') $('#settings-company').hide();
      if (value == 'company') $('#settings-company').show();

      $("#account_type").change(function() {
        value = $('#account_type :selected').val();
        if (value == 'private') $('#settings-company').fadeOut("fast");
        if (value == 'company') $('#settings-company').fadeIn("fast");
      });
    },

    LeadSound: function(){
      $('#lead_sound').change(function(){
        var lead_sound = $(this).val();
        if (lead_sound == 0) $("#lead_sound_player").attr({'src':''});
        if (lead_sound > 0) $("#lead_sound_player").attr({'src':'/assets/audio/lead/' + lead_sound + '.mp3','autoplay':'autoplay'});
      });
    },
}

var Support = {
    init: function () {

    that = this;
    that.Choices();
    that.Trumbowyg();
    },

    Choices: function(){
      if ($('#section').length){
         var section = new Choices('#section', {
          search: false,
          shouldSort: false,
          itemSelectText: 'Kliknij aby wybrać',
        });
      }
    },

    Trumbowyg: function(){
      $('#messages').trumbowyg({
        btns: [
          ['formatting'],
          'btnGrp-semantic',
          ['superscript', 'subscript'],
          ['link'],
          ['insertImage'],
          'btnGrp-justify',
          'btnGrp-lists',
          ['horizontalRule'],
          ['removeformat'],
        ],
        autogrow: true,
        removeformatPasted: true,
        lang: 'pl',
      });
    },
}

var LockerWidget = {
    init: function () {

    that = this;
    that.PaymentMultiSelect();
    that.ColorPicker();
    that.ColorBackground();
    that.ColorButton();
    that.Checkbox();
    that.AutoRule();
    that.IntroText();
    that.ButtonText();
    },

    PaymentMultiSelect(){
      new Choices('#payment', {
        delimiter: ',',
        maxItemCount: 3,
         addItems: true,
         itemSelectText: '',
        search: false,
        removeItemButton: true,
      });
    },

    ColorPicker: function(){
        $('[data-plugin="minicolors"]').minicolors({
          control: 'hue',
          format: 'hex',
          theme: 'bootstrap',
        });
    },

    ColorButton: function(){
      $("#color-button-input").change(function() {
        var color = $('#color-button .minicolors-swatch-color').attr("style");
        $("#content-locker #button").attr("style", color);
      });
    },

    ColorBackground: function(){
      $("#color-background-input").change(function() {
        var color = $('#color-background .minicolors-swatch-color').attr("style");
        $(".content-locker-layer").attr("style", color);
      });
    },

    Checkbox: function(){
        $('[data-plugin="labelauty"]').labelauty();
    },

    AutoRule: function(){
      $('#auto_rule').change(function() {
        if($(this).is(":checked")) {
          $('#content-locker .rule-checkbox').hide();
          $('#content-locker .rule-text').show();
          $('#rule-text-button').html($('#text_button').val());
        }else{
          $('#content-locker .rule-checkbox').show();
          $('#content-locker .rule-text').hide();
        }        
      });
    },

    ButtonText: function(){
      var buttonTextSelect = new Choices('#buttonTextSelect', {
        search: false,
        shouldSort: false,
        itemSelectText: 'Kliknij aby wybrać',
      });

      $("#buttonTextSelect").on('change', function() {
        if ($(this).val() != 'notselect') {
          $('#buttonTextInput').val($(this).text());
          $('#content-locker #button').text($(this).text());
          $('#rule-text-button').html($(this).text());
          $('#WidgetLockerForm').formValidation('revalidateField', 'buttonTextInput');
        }
      });

      $('#buttonTextInput').on('keyup', function() {
        if($('#buttonTextSelect').val() != 'notselect') buttonTextSelect.setValueByChoice('notselect');
        if ($(this).val().length > 0) $('#content-locker #button').text($(this).val());
        if ($(this).val().length == 0) $('#content-locker #button').text('Odblokuj');
        $('#rule-text-button').html($(this).val());
      });
    },

    IntroText: function(){
      var introTextSelect = new Choices('#introTextSelect', {
        search: false,
        shouldSort: false,
        itemSelectText: 'Kliknij aby wybrać',
      });

      $("#introTextSelect").on('change', function() {
        if ($(this).val() != 'notselect') {
          $('#introTextInput').val($(this).text());
          $('#content-locker #intro').text($(this).text());
          $('#WidgetLockerForm').formValidation('revalidateField', 'introTextInput');
        }
      });

    $('#introTextInput').on('keyup', function() {
        if($('#introTextSelect').val() != 'notselect') introTextSelect.setValueByChoice('notselect');
        if ($(this).val().length > 0) $('#content-locker #intro').text($(this).val());
        if ($(this).val().length == 0) $('#content-locker #intro').text('Dostęp zablokowany! Wykup premium.');
      });
    },
}

var PlayerWidget = {
    init: function () {

    that = this;
    that.PaymentMultiSelect();
    that.ColorPicker();
    that.ColorBackground();
    that.ColorButton();
    that.Checkbox();
    that.AutoRule();
    that.IntroText();
    that.ButtonText();
    that.VideoUrl();
    that.CoverUrl();
    that.PlayerWidget();
    },

    PaymentMultiSelect(){
      new Choices('#payment', {
        delimiter: ',',
        maxItemCount: 3,
         addItems: true,
         itemSelectText: '',
        search: false,
        removeItemButton: true,
      });
    },

    ColorPicker: function(){
        $('[data-plugin="minicolors"]').minicolors({
          control: 'hue',
          format: 'hex',
          theme: 'bootstrap',
        });
    },

    ColorButton: function(){
      $("#color-button-input").change(function() {
        var color = $('#color-button .minicolors-swatch-color').attr("style");
        $("#content-locker #button").attr("style", color);
      });
    },

    ColorBackground: function(){
      $("#color-background-input").change(function() {
        var color = $('#color-background .minicolors-swatch-color').attr("style");
        $(".content-locker-layer").attr("style", color);
      });
    },

    Checkbox: function(){
        $('[data-plugin="labelauty"]').labelauty();
    },

    AutoRule: function(){
      $('#auto-rule').change(function() {
        if($(this).is(":checked")) {
          $('#content-locker .rule-checkbox').hide();
          $('#content-locker .rule-text').show();
          $('#rule-text-button').html($('#text-button').val());
        }else{
          $('#content-locker .rule-checkbox').show();
          $('#content-locker .rule-text').hide();
        }        
      });
    },

    ButtonText: function(){
        $('#text-button').on('keyup', function() {
        var text = $(this).val();
        $('#content-locker #button').text(text);
      });
    },

    IntroText: function(){
      $('#text-intro').on('keyup', function() {
        var text = $(this).val();
        $('#content-locker #intro').text(text);
      });
    },

    VideoUrl: function(){
      $("#videodefault").change(function() {
      var videoDefault = $('#videodefault :selected').val();
      var videourl = $('#videourl');
        if (videoDefault !=0) videourl.val(videoDefault);
        if (videoDefault =0) videourl.val('');
      });
    },

    CoverUrl: function(){
      $("#coverdefault").change(function() {
      var coverDefault = $('#coverdefault :selected').val();
      var coverurl = $('#coverurl');
        if (coverDefault !=0) coverurl.val(coverDefault);
        if (coverDefault =0) coverurl.val('');
      });

    },

    PlayerWidget: function(){
      var player = videojs('player', { "controls": true, "autoplay": false});

      var time = $('#time').val();
      
      $('#refresh').on('click',function(){

        //Refresh Cover Player
        if ($('#coverurl').val()) var cover = $('#coverurl').val();
        if (!$('#coverurl').val()) var cover = '/assets/img/widgets/player/posters/paramount.png';

        $('.vjs-poster').attr('style', 'background-image: url('+ cover +');');

        //Refresh Video Player
        if ($('#videourl').val()) var video = $('#videourl').val();
        if (!$('#videourl').val()) var video = '/assets/video/widgets/player/paramount.mp4';

        player.src({src: video});

        //Hide Content Locker
        $('.content-locker-layer, #content-locker').hide();

        //Toggle Adult Icon
        if($('#adult').is(":checked")) $('.player-widget .adult-icon').show();
        if(!$('#adult').is(":checked")) $('.player-widget .adult-icon').hide();

        //Toggle Player Autostart
        if($('#autostart').is(":checked")) player.play();

        //Toggle Progress
        if($('#progress').is(":checked")) $('#player .vjs-remaining-time-display, #player .vjs-progress-control').show();
        if(!$('#progress').is(":checked")) $('#player .vjs-remaining-time-display, #player .vjs-progress-control').hide();

        //Toggle Controls
        if($('#controls').is(":checked")) $('#player .vjs-control-bar').attr('style', 'bottom: 0px');
        if(!$('#controls').is(":checked")) $('#player .vjs-control-bar').attr('style', 'bottom: -30px');

        //Set Time to Show Content Locker
        player.on('loadedmetadata', function() {
          var duration = Math.round(player.duration());
          if (time <= duration) time = $('#time').val();
          if (time > duration) time = duration;
        });
      });

      //Set Time to Show Content Locker
      player.on('loadedmetadata', function() {
        var duration =  Math.round(player.duration());
        if (time <= duration) time;
        if (time > duration) time = duration;
      });

    // Check Time and Show Content Locker
      player.on("play",function(){
      var stop = false;
      
      function locker(){
        if (Math.round(player.currentTime()) >= time) {
          if (!$(".content-locker-layer, #content-locker").is(':visible')){
            $('.content-locker-layer, #content-locker').show();
            player.pause();
            player.exitFullscreen();
            stop = true;
          }
        }
      }

      var interval = setInterval(function(){ 
        locker();

        if(stop) clearInterval(interval);

      },100);
    });
  },
}